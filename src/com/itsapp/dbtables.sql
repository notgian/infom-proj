/* CORE ENTITIES */
/* equipment, student, lab tech, and org tables for testing only */

/* DROP TABLES ONLY FOR TESTING */
DROP TABLE IF EXISTS `equipment_transaction_log`;
DROP TABLE IF EXISTS `lab_reservation_log`;
DROP TABLE IF EXISTS `lab_class_schedule`;
DROP TABLE IF EXISTS `org_students`;

DROP TABLE IF EXISTS `equipment`;
DROP TABLE IF EXISTS `student`;
DROP TABLE IF EXISTS `lab_technician`;
DROP TABLE IF EXISTS `organization`;
DROP TABLE IF EXISTS `laboratory`;


CREATE TABLE IF NOT EXISTS `equipment` (
    equipment_code INTEGER NOT NULL ,
    name VARCHAR(30),
    description VARCHAR (100),
    status VARCHAR (10),

    CHECK (status IN ('usable', 'broken')),
    CHECK (equipment_code >= 100000 AND equipment_code <= 999999),
    PRIMARY KEY (equipment_code)
);

CREATE TABLE IF NOT EXISTS `student` (
    student_id INTEGER NOT NULL,
    first_name VARCHAR(15),
    last_name VARCHAR(15),

    CHECK (student_id >= 10000000 AND student_id <= 99999999),
    PRIMARY KEY (student_id)
);

CREATE TABLE IF NOT EXISTS `lab_technician` (
    lab_tech_id INTEGER NOT NULL,
    first_name VARCHAR(15),
    last_name VARCHAR(15),

    CHECK (lab_tech_id >= 10000000 AND lab_tech_id <= 99999999),
    PRIMARY KEY (lab_tech_id)
);

CREATE TABLE IF NOT EXISTS `organization` (
    org_id INTEGER NOT NULL, 
    org_name VARCHAR(30),

    PRIMARY KEY (org_id)
);

CREATE TABLE IF NOT EXISTS `laboratory` (
    lab_code INTEGER NOT NULL, 
    lab_name VARCHAR(10), 
    description VARCHAR(200), 
    capacity INTEGER, 

    PRIMARY KEY (lab_code)
);

/* TRANSACTION ENTITIES */

-- For recording equipment-related transactions
CREATE TABLE IF NOT EXISTS `equipment_transaction_log` (
    transaction_id INTEGER NOT NULL ,
    student_id INTEGER, -- SET FK
    equipment_id INTEGER, -- SET KN
    lab_tech_id INTEGER, -- SET FK
    date DATE, -- date of transaction
    remarks VARCHAR(2000),
    status VARCHAR(8), -- borrowed, broken, returned, replaced

    CHECK (status IN ('borrowed', 'broken', 'returned', 'replaced') ),
    PRIMARY KEY (transaction_id),
    FOREIGN KEY (student_id) REFERENCES student (student_id),
    FOREIGN KEY (equipment_id) REFERENCES equipment (equipment_code),
    FOREIGN KEY (lab_tech_id) REFERENCES lab_technician (lab_tech_id)
);


CREATE TABLE IF NOT EXISTS `lab_reservation_log` ( -- unlike the equipment borrow/return log will have reservations listed here. Cancelled reserations will be flagged as such
    reservation_id INTEGER NOT NULL ,
    organization_id INTEGER, -- SET FK
    laboratory_id INTEGER, -- SET FK
    lab_tech_id INTEGER, -- SET FK
    date DATE,
    reservation_date DATE,
    start_time TIME,
    end_time TIME,
    remarks VARCHAR(2000),
    status VARCHAR(10) -- 'reserved, cancelled'

    CHECK ( TIMEDIFF(end_time, start_time) >= 1),
    PRIMARY KEY (reservation_id),
    FOREIGN KEY (organization_id) REFERENCES organization (org_id),
    FOREIGN KEY (laboratory_id) REFERENCES laboratory (lab_code),
    FOREIGN KEY (lab_tech_id) REFERENCES lab_technician (lab_tech_id)
);

/* SECONDARY ENTITIES */

CREATE TABLE IF NOT EXISTS `lab_class_schedule` (
    laboratory_id INTEGER, -- SET FK
    start_time TIME,
    end_time TIME,
    day TIME,

    CHECK ( TIMEDIFF(end_time, start_time) >= 1),
    PRIMARY KEY (laboratory_id, start_time, end_time, day),
    FOREIGN KEY (laboratory_id) REFERENCES laboratory (lab_code)
);

CREATE TABLE IF NOT EXISTS `org_students` (
    student_id INTEGER, -- SET FK
    organization_id INTEGER, -- SET FK

    PRIMARY KEY (student_id, organization_id),
    FOREIGN KEY (student_id) REFERENCES student (student_id),
    FOREIGN KEY (organization_id) REFERENCES organization (org_id)
);

/* SAMPLE DATA INSERT */
/* NOTE: THIS SAMPLE DATA WAS GENERATED BY GEMINI */

INSERT INTO `equipment` (`equipment_code`, `name`, `description`, `status`) VALUES
(100001, 'Microscope', 'Standard compound light microscope', 'usable'),
(100002, 'Beaker (500ml)', 'Glass beaker, 500ml capacity', 'usable'),
(100003, 'Bunsen Burner', 'Standard lab gas burner', 'usable'),
(100004, 'Test Tube Rack', 'Wooden rack, holds 12 tubes', 'usable'),
(100005, 'Graduated Cylinder (100ml)', 'Glass cylinder, 100ml', 'broken'),
(100006, 'Digital Scale', 'Measures up to 500g', 'usable'),
(100007, 'Safety Goggles', 'Standard eye protection', 'usable'),
(100008, 'Volumetric Flask (250ml)', 'Class A, 250ml', 'usable'),
(100009, 'Microscope', 'Older model, slight blur', 'usable'),
(100010, 'Bunsen Burner', 'Igniter is faulty', 'broken');

INSERT INTO `student` (`student_id`, `first_name`, `last_name`) VALUES
(20000001, 'Alice', 'Smith'),
(20000002, 'Bob', 'Johnson'),
(20000003, 'Charlie', 'Brown'),
(20000004, 'David', 'Lee'),
(20000005, 'Emily', 'Wang'),
(20000006, 'Fiona', 'Chen'),
(20000007, 'George', 'Kim'),
(20000008, 'Hannah', 'Davis'),
(20000009, 'Ian', 'Miller'),
(20000010, 'Jane', 'Wilson');

INSERT INTO `lab_technician` (`lab_tech_id`, `first_name`, `last_name`) VALUES
(30000001, 'Martin', 'Price'),
(30000002, 'Sarah', 'Connor'),
(30000003, 'Kyle', 'Reese'),
(30000004, 'John', 'Doe'),
(30000005, 'Lisa', 'Ray'),
(30000006, 'Tom', 'Harris'),
(30000007, 'Nancy', 'Drew'),
(30000008, 'Peter', 'Venkman'),
(30000009, 'Dana', 'Scully'),
(30000010, 'Fox', 'Mulder');

INSERT INTO `organization` (`org_id`, `org_name`) VALUES
(101, 'Chemistry Club'),
(102, 'Biology Society'),
(103, 'Physics Club'),
(104, 'Engineering Guild'),
(105, 'Robotics Team'),
(106, 'Pre-Med Association'),
(107, 'Computer Science Society'),
(108, 'Aeronautics Club'),
(109, 'Marine Biology Group'),
(110, 'Botany Enthusiasts');

INSERT INTO `laboratory` (`lab_code`, `lab_name`, `description`, `capacity`) VALUES
(501, 'Chem 1', 'General Chemistry Laboratory', 30),
(502, 'Bio 1', 'General Biology Laboratory', 25),
(503, 'Phys 1', 'General Physics Laboratory', 20),
(504, 'CS 1', 'Computer Science Lab (Linux)', 40),
(505, 'Eng 1', 'Engineering Workshop', 15),
(506, 'Chem 2', 'Organic Chemistry Lab', 20),
(507, 'Bio 2', 'Microbiology Lab', 25),
(508, 'CS 2', 'Computer Science Lab (Windows)', 40),
(509, 'Phys 2', 'Optics Lab', 15),
(510, 'Research', 'Faculty Research Lab', 10);

INSERT INTO `equipment_transaction_log` (`transaction_id`, `student_id`, `equipment_id`, `lab_tech_id`, `date`, `remarks`, `status`) VALUES
(1, 20000001, 100001, 30000001, '2025-10-01', 'For Bio 101 class', 'borrowed'),
(2, 20000002, 100002, 30000001, '2025-10-01', 'For Chem 101 experiment', 'borrowed'),
(3, 20000001, 100001, 30000001, '2025-10-02', 'Returned in good condition', 'returned'),
(4, 20000003, 100005, 30000002, '2025-10-03', 'Student reported it was already cracked', 'borrowed'),
(5, 20000003, 100005, 30000002, '2025-10-03', 'Confirmed crack, marked as broken', 'broken'),
(6, 20000004, 100006, 30000003, '2025-10-04', 'Borrowing for physics project', 'borrowed'),
(7, 20000005, 100007, 30000004, '2025-10-05', 'Standard procedure for lab entry', 'borrowed'),
(8, 20000005, 100007, 30000004, '2025-10-05', 'Returned after lab session', 'returned'),
(9, 20000006, 100003, 30000001, '2025-10-06', 'Borrowing for Chem 2 lab', 'borrowed'),
(10, 20000007, 100010, 30000005, '2025-10-07', 'Student reported faulty igniter', 'broken');

INSERT INTO `lab_reservation_log` (`reservation_id`, `organization_id`, `laboratory_id`, `lab_tech_id`, `date`, `reservation_date`, `start_time`, `end_time`, `remarks`, `status`) VALUES
(1001, 101, 501, 30000001, '2025-10-01', '2025-10-15', '17:00:00', '19:00:00', 'Chemistry Club monthly meeting', 'reserved'),
(1002, 102, 502, 30000002, '2025-10-02', '2025-10-16', '18:00:00', '20:00:00', 'Biology Society speaker event', 'reserved'),
(1003, 105, 505, 30000003, '2025-10-03', '2025-10-17', '15:00:00', '18:00:00', 'Robotics Team build session', 'reserved'),
(1004, 107, 504, 30000004, '2025-10-04', '2025-10-18', '17:00:00', '21:00:00', 'CS Society coding competition', 'reserved'),
(1005, 103, 503, 30000005, '2025-10-05', '2025-10-19', '16:00:00', '18:00:00', 'Physics Club experiment demo', 'reserved'),
(1006, 101, 501, 30000001, '2025-10-06', '2025-10-20', '17:00:00', '19:00:00', 'Meeting cancelled, room needed for class', 'cancelled'),
(1007, 104, 505, 30000003, '2025-10-07', '2025-10-21', '14:00:00', '17:00:00', 'Engineering Guild project work', 'reserved'),
(1008, 106, 507, 30000002, '2025-10-08', '2025-10-22', '18:00:00', '20:00:00', 'Pre-Med guest lecture', 'reserved'),
(1009, 108, 503, 30000005, '2025-10-09', '2025-10-23', '16:00:00', '18:00:00', 'Aeronautics Club weekly meeting', 'reserved'),
(1010, 109, 502, 30000002, '2025-10-10', '2025-10-24', '17:00:00', '19:00:00', 'Marine Biology film screening', 'reserved');

INSERT INTO `lab_class_schedule` (`laboratory_id`, `start_time`, `end_time`, `day`) VALUES
(501, '08:00:00', '09:50:00', '01:00:00'), -- Lab 501, 8:00-9:50, Monday
(501, '10:00:00', '11:50:00', '01:00:00'), -- Lab 501, 10:00-11:50, Monday
(502, '08:00:00', '09:50:00', '02:00:00'), -- Lab 502, 8:00-9:50, Tuesday
(502, '13:00:00', '14:50:00', '02:00:00'), -- Lab 502, 13:00-14:50, Tuesday
(503, '10:00:00', '11:50:00', '03:00:00'), -- Lab 503, 10:00-11:50, Wednesday
(504, '13:00:00', '14:50:00', '03:00:00'), -- Lab 504, 13:00-14:50, Wednesday
(504, '15:00:00', '16:50:00', '03:00:00'), -- Lab 504, 15:00-16:50, Wednesday
(505, '09:00:00', '11:50:00', '04:00:00'), -- Lab 505, 9:00-11:50, Thursday
(506, '10:00:00', '12:50:00', '05:00:00'), -- Lab 506, 10:00-12:50, Friday
(507, '14:00:00', '15:50:00', '01:00:00'); -- Lab 507, 14:00-15:50, Monday

INSERT INTO `org_students` (`student_id`, `organization_id`) VALUES
(20000001, 101), -- Alice in Chemistry Club
(20000001, 102), -- Alice in Biology Society
(20000002, 101), -- Bob in Chemistry Club
(20000003, 103), -- Charlie in Physics Club
(20000004, 107), -- David in Computer Science Society
(20000005, 107), -- Emily in Computer Science Society
(20000005, 105), -- Emily in Robotics Team
(20000006, 106), -- Fiona in Pre-Med Association
(20000007, 104), -- George in Engineering Guild
(20000008, 102); -- Hannah in Biology Society
